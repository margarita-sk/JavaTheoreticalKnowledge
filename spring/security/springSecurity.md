Ключевые объекты контекста Spring Security:


SecurityContextHolder, в нем содержится информация о текущем контексте безопасности приложения, который включает в себя подробную информацию о пользователе(Principal) работающем в настоящее время с приложением. По умолчанию SecurityContextHolder используетThreadLocal для хранения такой информации, что означает, что контекст безопасности всегда доступен для методов исполняющихся в том же самом потоке. Для того что бы изменить стратегию хранения этой информации можно воспользоваться статическим методом класса SecurityContextHolder.setStrategyName(String strategy). Более подробно SecurityContextHolder
SecurityContext, содержит объект Authentication и в случае необходимости информацию системы безопасности, связанную с запросом от пользователя.
Authentication представляет пользователя (Principal) с точки зрения Spring Security.
GrantedAuthority отражает разрешения выданные пользователю в масштабе всего приложения, такие разрешения (как правило называются «роли»), например ROLE_ANONYMOUS, ROLE_USER, ROLE_ADMIN.
UserDetails предоставляет необходимую информацию для построения объекта Authentication из DAO объектов приложения или других источников данных системы безопасности. Объект UserDetailsсодержит имя пользователя, пароль, флаги: isAccountNonExpired, isAccountNonLocked, isCredentialsNonExpired, isEnabled и Collection — прав (ролей) пользователя.
UserDetailsService, используется чтобы создать UserDetails объект путем реализации единственного метода этого интерфейса

UserDetails loadUserByUsername(String username) throws UsernameNotFoundException; 


Позволяет получить из источника данных объект пользователя и сформировать из него объект UserDetails который будет использоваться контекстом Spring Security.


Аутентификация


(1) Пользователю будет предложено войти в систему предоставив имя (логин или email) и пароль. Имя пользователя и пароль объединяются в экземпляр класса UsernamePasswordAuthenticationToken(экземпляр интерфейса Authentication) после чего он передается экземпляру AuthenticationManager для проверки.

(2) В случае если пароль не соответствует имени пользователя будет выброшено исключение BadCredentialsException с сообщением “Bad Credentials”.

(3) Если аутентификация прошла успешно возвращает полностью заполненный экземпляр Authentication.

(4) Для пользователя устанавливается контекст безопасности путем вызова метода SecurityContextHolder.getContext().setAuthentication(…), куда передается объект который вернул AuthenticationManager.





Все @PreAuthorize , @RolesAllowed и @Secured являются аннотациями, которые позволяют настроить безопасность метода . Они могут применяться как на отдельных методах, так и на уровне класса, в последнем случае ограничения безопасности будут применяться ко всем методам в классе.

Безопасность на уровне метода достигается с помощью прокси-серверов Spring AOP .

@PreAuthorize
Аннотация @PreAuthorize позволяет задать ограничения доступа к методу с помощью языка выражений Spring (SpEL) . Эти ограничения оцениваются до выполнения метода и могут привести к тому, что выполнение метода будет отклонено, если ограничения не будут выполнены. Аннотация @PreAuthorize является частью фреймворка Spring Security.

Чтобы иметь возможность использовать @PreAuthorize , атрибут prePostEnabled в аннотации @EnableGlobalMethodSecurity должен быть установлен в true :

@EnableGlobalMethodSecurity(prePostEnabled=true)
@RolesAllowed
Аннотация @RolesAllowed берет свое начало в стандарте безопасности JSR-250 Java. Эта аннотация более ограничена , чем аннотация @PreAuthorize , поскольку она поддерживает только безопасность на основе ролей .

Чтобы использовать аннотацию @RolesAllowed , библиотека, содержащая эту аннотацию, должна быть на classpath, так как она не является частью Spring Security. Кроме того, атрибут jsr250Enabled аннотации @EnableGlobalMethodSecurity должен быть установлен в значение true :

@EnableGlobalMethodSecurity(jsr250Enabled=true)
@Secured
Аннотация @Secured - это устаревшая аннотация Spring Security 2 , которая может быть использована для настройки безопасности метода. Он поддерживает не только безопасность на основе ролей, но и не поддерживает использование языка выражений Spring (SpEL) для указания ограничений безопасности. Рекомендуется использовать аннотацию @PreAuthorize в новых приложениях поверх этой аннотации.
